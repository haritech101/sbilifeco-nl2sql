services:
    metadata-storage:
        image: sbilife/metadata-storage:202507.24.0828
        restart: always
        volumes:
            - /var/lib/sbilifeco/db-metadata:/var/lib/sbilifeco/db-metadata
        ports:
            - 11202:80
        environment:
            - MICROSERVICE_PORT=80
            - DB_HOST=postgres
            - DB_PORT=5432
            - DB_USERNAME=synmetrix
            - DB_PASSWORD=synmetrix
            - DB_NAME=synmetrix
            - AUTH_PROTO=http
            - AUTH_HOST=synmetrix
            - AUTH_PORT=8081
            - AUTH_USERNAME=demo@synmetrix.org
            - AUTH_PASSWORD=demodemo
            - AUTH_PATH=/auth/login
            - CUBE_HOST=synmetrix
            - CUBE_PORT=4000

        labels:
            - traefik.http.routers.metadata-storage.rule=PathPrefix(`/api/v1/db-metadata`)
            - traefik.http.services.metadata-storage.loadbalancer.server.url=http://metadata-storage
    llm:
        image: sbilife/llm:202507.01.0829
        restart: always
        environment:
            - LLM_MODEL=gemini-1.5-flash
            - API_KEY=AIzaSyANExa3L6OVR0RevN8zteCuA8agcPFl3EU
        ports:
            - 11203:80
        labels:
            - traefik.http.routers.llm.rule=PathPrefix(`/api/v1/llm`)
            - traefik.http.services.llm.loadbalancer.server.url=http://llm
    query-flow:
        image: sbilife/query-flow:202506.30.1401
        restart: always
        environment:
            - LLM_HOST=llm
            - METADATA_STORAGE_HOST=metadata-storage
        ports:
            - 11204:80
        labels:
            - traefik.http.routers.query-flow.rule=PathPrefix(`/api/v1/query-flow`)
            - traefik.http.services.query-flow.loadbalancer.server.url=http://query-flow
    traefik:
        image: traefik:3.4.1
        restart: always
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
        command:
            - --api.insecure=true
            - --providers.docker=true
        ports:
            - 11200:80
            - 11201:8080
    metadata-manager:
        image: sbilife/metadata-manager:202506.30.1955
        restart: always
        environment:
            - VITE_API_PROTO=${VITE_API_PROTO:-http}
            - VITE_API_HOST=${VITE_API_HOST:-localhost}
            - VITE_API_PORT=${VITE_API_PORT:-80}
        ports:
            - 11205:80
    query-generator-ui:
        image: sbilife/query-generator-ui:202507.01.1442
        restart: always
        environment:
            - VITE_METADATA_URL=${VITE_METADATA_URL:-http://localhost}
            - VITE_QUERY_FLOW_URL=${VITE_QUERY_FLOW_URL:-http://localhost}
        ports:
            - 11206:80
    redis:
        image: redis:7.0.0
        restart: always

    postgres:
        image: postgres:13
        restart: always
        ports:
            - 11210:5432
        volumes:
            - ./.local/.pg:/var/lib/postgresql/data
        env_file: .local/pg.env

    cubestore:
        image: cubejs/cubestore:v0.35.33
        restart: always
        env_file: .local/cube.env
        volumes:
            - ./.local/.cube:/cube/data

    synmetrix:
        image: synmetrix/stack:latest
        restart: always
        ports:
            - 11207:8888
            - 11208:4000
            - 11209:8081
        env_file: .local/synmetrix.env
    materialsed-data:
        image: postgres:17.5
        restart: always
        env_file: ./.local/materialised.env
        volumes:
            - ./.local/.materialised:/var/lib/postgresql/data
    dematerialised-data:
        image: postgres:17.5
        restart: always
        env_file: ./.local/dematerialised.env
        volumes:
            - ./.local/.dematerialised:/var/lib/postgresql/data
